---
import Layout from '../layouts/Layout.astro';
import LandingPage from "../assets/landing-page.svg";
import Sign from "../assets/sign-and-pigeon.svg";
import Lillypad1 from "../assets/lillypad-1.svg";
import Lillypad2 from "../assets/lillypad-2.svg";
import Lillypad3 from "../assets/lillypad-3.svg";
import Lillypad4 from "../assets/lillypad-4.svg";
import Lillypad5 from "../assets/lillypad-5.svg";
import Lillypad6 from "../assets/lillypad-6.svg";
import Bus from "../assets/bus.svg";
import BusShadow from "../assets/bus-shadow.svg";
import MetaQuest from '../assets/prizes/meta-quest.png';
import RayBanMeta from '../assets/prizes/ray-ban-meta.png';
import NordSecurity from '../assets/prizes/nord-security.png';
import BeatsFitPro from '../assets/prizes/beats-fit-pro.png';
import RedragonKeyboard from '../assets/prizes/redragon-keyboard.webp';

const partnerModules = import.meta.glob('../assets/partners/*', { eager: true });
const partners: string[] = Object.values(partnerModules).map((mod: any) => mod.default.src ?? mod.default);

const partnerUrlMap: Record<string, string> = {
  nordvpn:    "https://nordvpn.com/hackathons",
  incogni:    "https://incogni.com/",
  nordpass:   "https://nordpass.com/",
  saily:      "https://saily.com/",
  "nexos-ai": "https://nexos.ai/",
};

const partnerUrls: string[] = Object.keys(partnerModules).map((path) => {
  const filename = path.toLowerCase();
  for (const [key, url] of Object.entries(partnerUrlMap)) {
    if (filename.includes(key)) return url;
  }
  return "";
});

const teamModules = import.meta.glob('../assets/headshots/*.webp', { eager: true });
const teamMembers: string[] = Object.values(teamModules).map((mod: any) => mod.default.src ?? mod.default);

const memberData: Record<string, { name: string; role: string }> = {
  AlvinMoy:        { name: "Alvin Moy",        role: "Design Team Lead" },
  ElleHamilton:    { name: "Elle Hamilton",     role: "Design Team" },
  JasonDieckhaus:  { name: "Jason Dieckhaus",   role: "Logistics Team Lead" },
  JoshuaKroft:     { name: "Joshua Kroft",      role: "Design Team" },
  MarcellaTebeau:  { name: "Marcella Tebeau",   role: "Design Team" },
  MatthewMartin:   { name: "Matthew Martin",    role: "Development Team Lead" },
  SayamGupta:      { name: "Sayam Gupta",       role: "Development Team" },
  TobiasBessler:   { name: "Tobias Bessler",    role: "Development Team Lead" },
  MaxKlein:        { name: "Max Klein",         role: "Finance Team" },
  TylerSanford:    { name: "Tyler Sanford",     role: "Director" },
  JadaCastile:     { name: "Jada Castile",      role: "Logistics Team" },
};

const busWindows = [
  { svgX: 36,   svgY: 52, svgW: 145.5, svgH: 130 },
  { svgX: 198,  svgY: 52, svgW: 115,   svgH: 111 },
  { svgX: 329,  svgY: 52, svgW: 115,   svgH: 111 },
  { svgX: 460,  svgY: 52, svgW: 115,   svgH: 111 },
  { svgX: 585,  svgY: 52, svgW: 115,   svgH: 111 },
  { svgX: 721,  svgY: 52, svgW: 115,   svgH: 111 },
];

const days = [
  {
    label: "Friday, Feb 27",
    events: [
      { time: "3:00 PM", title: "Hacker Check-In", location: "Havener Center St. Pats Ballroom" },
      { time: "4:00 - 5:00 PM", title: "Opening Ceremony", location: "Havener Center St. Pats Ballroom" },
      { time: "5:00 PM", title: "Hacking Begins", location: "Innovation Lab / Havener Center" },
      { time: "5:00 PM", title: "Notion Team Building by MLH", location: "Innovation Lab 115" },
      { time: "6:00 - 7:00 PM", title: "Red Bull Basement Workshop", location: "Innovation Lab Room 115" },
      { time: "7:00 - 8:00 PM", title: "Dinner", location: "Havener Center St. Pats Ballroom" },
      { time: "9:00 - 9:30 PM", title: "Hacking with GitHub CoPilot by MLH", location: "Innovation Lab Room 115" },
      { time: "9:00 - 10:00 PM", title: "Late Night Snack", location: "Havener Center St. Pats Ballroom" },
    ],
  },
  {
    label: "Saturday, Feb 28",
    events: [
      { time: "8:00 - 9:30 AM", title: "Breakfast", location: "Havener Center St. Pats Ballroom" },
      { time: "11:00 AM - 12:00 PM", title: "Sponsor Career Fair", location: "Havener Center St. Pats Ballroom" },
      { time: "12:30 - 1:30 PM", title: "Lunch", location: "Havener Center St. Pats Ballroom" },
      { time: "2:00 - 3:00 PM", title: "MLH Event", location: "Innovation Lab Forum" },
      { time: "5:00 - 6:00 PM", title: "MLH Event", location: "Innovation Lab Forum" },
      { time: "6:00 - 7:00 PM", title: "Dinner", location: "Havener Center St. Pats Ballroom" },
      { time: "7:30 PM - 8:30", title: "Bob Ross Painting by MLH", location: "Innovation Lab Room 115" },
      { time: "9:00 PM", title: "Late Night Snack", location: "Havener Center St. Pats Ballroom" },
    ],
  },
  {
    label: "Sunday, Mar 1",
    events: [
      { time: "8:00 - 9:30 AM", title: "Breakfast", location: "Havener Center St. Pats A,B,C" },
      { time: "10:00 AM", title: "Submission Deadline", location: "Devpost" },
      { time: "10:00 AM - 2:00 PM", title: "Travel Reimbursement", location: "Havener Center" },
      { time: "11:00 AM - 1:00 PM", title: "Judging", location: "Innovation Lab Room 115" },
      { time: "1:00 - 2:00 PM", title: "Lunch", location: "Havener Center St. Pats A,B,C" },
      { time: "2:00 - 3:00 PM", title: "Closing Ceremony", location: "Havener Center St. Pats A,B,C" },
    ],
  },
];

const lillypads = [
  { src: Lillypad1.src, cls: "absolute left-[10%] top-[58%] w-[14%] z-10" },
  { src: Lillypad2.src, cls: "absolute left-[18%] top-[66%] w-[14%] z-10" },
  { src: Lillypad3.src, cls: "absolute left-[38%] top-[55%] w-[14%] z-10" },
  { src: Lillypad4.src, cls: "absolute left-[48%] top-[66%] w-[14%] z-10" },
  { src: Lillypad5.src, cls: "absolute left-[68%] top-[56%] w-[14%] z-10" },
  { src: Lillypad6.src, cls: "absolute left-[75%] top-[63%] w-[14%] z-10" },
];

const faqs = [
  {
    q: "What is PickHacks?",
    a: "PickHacks is Missouri S&T's annual hackathon. For one weekend, students from across the country come together to build, create, and compete. You come up with the idea, and we provide mentors, resources, and anything else you need. Programming experience isn't necessary; the only requirement is a willingness to learn and have fun!",
  },
  {
    q: "Can I participate virtually?",
    a: "Unfortunately, we will not be offering a virtual attendance option this year. PickHacks 2026 will be fully held in-person at the Innovation Lab to create an interactive environment and encourage everyone to network with our sponsors and meet new people.",
  },
  {
    q: "When will PickHacks take place?",
    a: "PickHacks is taking place the weekend of Feb 27th - March 1st!",
  },
  {
    q: "Who is eligible to apply?",
    a: "Anyone who is 18+ and currently enrolled at a college or university is able to attend! You don't even have to know how to code to join! Just come in with an open mind and fun ideas to expand on, and you'll be set!",
  },
  {
    q: "How big can my team be? Do I need a team?",
    a: "Each team can consist of up to 4 total members. Having a team isn't necessary to participate, but it's highly encouraged for you to form or join a team because it will transform the hackathon into an extremely fun and memorable experience! If you are interested in forming or joining a team, reach out in our Discord. If you don't have a team by the hackathon and are interested in one, don't worry! MLH will have their own team formation event you can attend..",
  },
  {
    q: "How much does it cost to attend PickHacks?",
    a: "Admission to PickHacks is completely free! We will also provide food and accommodation for the entire event, as well as all the resources and mentorship our hackers need to build something incredible. In terms of travel, partial reimbursement may be provided on a case-by-case basis.",
  },
  {
    q: "What if I've never been to a hackathon?",
    a: "We welcome students of all skill levels and majors. Hackathons are a fun way to learn new skills that you can add to your resume and connect with sponsors and other students while competing for prizes. We will have free swag at the event for anyone who comes! Additionally, there will be ample food provided for FREE throughout the weekend!",
  },
  {
    q: "Will there be places to sleep?",
    a: "Yes! If you're not from S&T, we will have designed sleeping areas at the hackathon! We will only have a few air mattresses, so make sure to bring your own sleeping bags if you can! You can also choose to rent your own room and stay at a hotel if that's easier or more comfortable for you.",
  },
];
---

<Layout>
  <div class="relative w-full overflow-hidden">
    <img class="block w-full h-auto align-middle" src={LandingPage.src} alt="PickHacks 2026" draggable="false" />
    <div class="absolute left-1/2 top-[11%] -translate-x-1/2 z-1 flex flex-col items-center gap-6">
      <h1 class="sm:text-5xl hidden sm:block text-3xl w-full text-center text-[#ebebeb] font-black text-nowrap stroke-2 stroke-white">February 27th - March 1st</h1>
      <a class="sm:text-3xl text-md sm:px-9 sm:py-3 px-6 py-2 text-[#ebebeb] font-bold border-3 sm:border-5 sm:border-[#bd6e44] rounded-xl active:scale-95 duration-100 transition-all bg-[#bd6e44] border-[#ebebeb] sm:bg-transparent sm:hover:bg-[#bd6e44]" href="https://register.pickhacks.io/">Register</a>
    </div>
    <img
      class="absolute left-1/2 top-[32%] w-[60%] sm:top-[35%] sm:w-[50%] -translate-x-1/2 z-10"
      src={Sign.src}
      alt=""
      aria-hidden="true"
      draggable="false"
    />
    <div class="schedule-list absolute left-1/2 top-[39.5%] sm:top-[41%] -translate-x-1/2 z-20 w-[40%] sm:w-[35%] overflow-y-auto max-h-[6.25%] sm:max-h-[5.25%] px-1 py-0.5 sm:px-2 sm:py-1 space-y-1 sm:space-y-2">
      {days.map((day) => (
        <div>
          <p class="font-black text-[0.4rem] sm:text-xs uppercase tracking-widest text-[#454444] mb-1 sm:mb-2 border-b-2 border-[#bd6e44] pb-0.5">{day.label}</p>
          <div>
            {day.events.map((event) => (
              <div class="grid grid-cols-[auto_1fr_auto] items-center gap-x-1 sm:gap-x-1.5">
                <span class="text-[0.38rem] sm:text-[0.7rem] text-[#bd6e44] font-bold whitespace-nowrap shrink-0">{event.time}</span>
                <span class="text-[0.38rem] sm:text-[0.7rem] font-semibold text-black truncate">{event.title}</span>
                <span class="text-[0.38rem] sm:text-[0.7rem] text-black text-right truncate max-w-[3rem] sm:max-w-none">{event.location}</span>
              </div>
            ))}
          </div>
        </div>
      ))}
    </div>

    {lillypads.map((pad, i) => (
      <div class={`${pad.cls} pad-wrapper`} data-index={i}>
        <div class="absolute inset-0 flex items-center justify-center">
          <a
            class="pad-link w-full h-full flex items-center justify-center"
            target="_blank"
            rel="nofollow"
          >
            <img
              class="pad-logo w-full h-full object-contain opacity-0 transition-opacity duration-400"
              src=""
              draggable="false"
            />
          </a>
        </div>
        <img src={pad.src} class="w-full" aria-hidden="true" draggable="false" />
      </div>
    ))}

    <img id="bus-shadow" src={BusShadow.src} class="absolute left-1/2 bottom-[3%] w-[85%] z-10" aria-hidden="true" draggable="false" />

    <div id="bus-container" class="absolute left-1/2 bottom-[3.5%] w-[85%] z-20">
      <img src={Bus.src} class="w-full h-auto block" aria-hidden="true" id="bus-img" draggable="false" />
      {busWindows.map((win, i) => (
        <div
          class="team-window group absolute overflow-hidden opacity-0 transition-opacity duration-200"
          data-index={i}
          data-svgx={win.svgX}
          data-svgy={win.svgY}
          data-svgw={win.svgW}
          data-svgh={win.svgH}
        >
          <img
            class="team-member-img w-full h-full object-cover"
            src=""
            alt="Team member"
            draggable="false"
          />
          <div class="team-member-name absolute bottom-0 left-0 right-0 text-center text-white text-xs font-semibold py-1 px-1 bg-[#264852] opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none leading-tight"></div>
        </div>
      ))}
    </div>
  </div>

<section id="prizes" class="bg-[#3c3b3b] px-6 py-20">
  <h2 class="mb-10 text-center text-6xl font-bold text-white">Prizes</h2>

  <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 max-w-5xl mx-auto">

    <div class="col-span-2 row-span-2 bg-[#222222] border-3 border-[#bd6e44] rounded-2xl p-10 flex flex-col items-center text-center gap-4 order-1 lg:order-2">
      <p class="text-xs text-[#bd6e44] uppercase tracking-widest font-bold">Best General</p>
      <img src={MetaQuest.src} alt="Meta Quest 3" class="size-60 object-contain" />
      <p class="text-white font-black text-2xl">Meta Quest 3</p>
    </div>

    <div class="bg-[#222222] rounded-md p-5 flex flex-col items-center text-center gap-3 order-2 lg:order-1">
      <p class="text-xs text-[#bd6e44] uppercase tracking-widest font-bold">Best AI</p>
      <img src={RayBanMeta.src} alt="Meta Glasses" class="h-30 w-40 object-contain" />
      <p class="text-white font-bold">Meta Glasses</p>
    </div>

    <div class="bg-[#222222] rounded-md p-5 flex flex-col items-center text-center gap-3 order-3">
      <p class="text-xs text-[#bd6e44] uppercase tracking-widest font-bold">Best Security</p>
      <img src={NordSecurity.src} alt="NordVPN Package" class="h-30 w-40 object-contain" />
      <p class="text-white font-bold">NordVPN Package</p>
    </div>

    <div class="bg-[#222222] rounded-md p-5 flex flex-col items-center text-center gap-3 order-4">
      <p class="text-xs text-[#bd6e44] uppercase tracking-widest font-bold">Best Solo</p>
      <img src={BeatsFitPro.src} alt="Beats Pro" class="size-30 object-contain" />
      <p class="text-white font-bold">Beats Fit Pro</p>
    </div>

    <div class="bg-[#222222] rounded-md p-5 flex flex-col items-center text-center gap-3 order-5">
      <p class="text-xs text-[#bd6e44] uppercase tracking-widest font-bold">Best Beginner</p>
      <img src={RedragonKeyboard.src} alt="Keyboard" class="h-30 w-30 object-contain" />
      <p class="text-white font-bold">Redragon K556</p>
    </div>

    <div class="text-center text-white font-bold text-2xl col-span-2 lg:col-span-4 order-6">and $500+ in other prizes!</div>
  </div>
</section>

  <section id="faq" class="bg-[#3c3b3b] px-6 py-20">
    <div class="mx-auto max-w-3xl">
      <h2 class="mb-10 text-center text-6xl font-bold text-white">FAQ</h2>
      <div class="flex flex-col">
        {faqs.map((item) => (
          <details class="group py-4">
            <summary class="flex cursor-pointer select-none list-none items-center justify-between gap-4 [&::-webkit-details-marker]:hidden">
              <span class="text-lg font-bold text-white">{item.q}</span>
              <svg class="h-4 w-4 flex-shrink-0 text-[#bd6e44] transition-transform duration-200 group-open:rotate-180" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                <path d="M6 9l6 6 6-6"/>
              </svg>
            </summary>
            <p class="mt-3 text-md leading-relaxed text-white">{item.a}</p>
          </details>
        ))}
      </div>
    </div>
  </section>
</Layout>

<style>
  img {
    -webkit-user-drag: none;
    user-select: none;
  }

  .schedule-list {
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 0, 0, 0.3) transparent;
  }
  .schedule-list::-webkit-scrollbar {
    width: 4px;
  }
  .schedule-list::-webkit-scrollbar-track {
    background: transparent;
  }
  .schedule-list::-webkit-scrollbar-thumb {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 9999px;
  }
  .schedule-list::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 0, 0, 0.5);
  }

  @keyframes busExit {
    from { transform: translateX(-50%); }
    to   { transform: translateX(-200%); }
  }
  @keyframes busEnter {
    from { transform: translateX(150%); }
    to   { transform: translateX(-50%); }
  }
  #bus-container { transform: translateX(-50%); }
  #bus-shadow    { transform: translateX(-50%); }
  #bus-container.bus-exit  { animation: busExit  1.2s cubic-bezier(0.4, 0, 1, 1) forwards; }
  #bus-container.bus-enter { animation: busEnter 1.2s cubic-bezier(0, 0, 0.3, 1) forwards; }
  #bus-shadow.bus-exit     { animation: busExit  1.2s cubic-bezier(0.4, 0, 1, 1) forwards; }
  #bus-shadow.bus-enter    { animation: busEnter 1.2s cubic-bezier(0, 0, 0.3, 1) forwards; }
</style>

<script define:vars={{ partners, partnerUrls }}>
  const pads = document.querySelectorAll('.pad-wrapper');
  const total = pads.length;

  if (partners.length === 0) return;

  const currentIndices = Array.from({ length: total }, (_, i) =>
    Math.floor((i * partners.length) / total)
  );

  function applyPartner(pad, index, fadeIn = true) {
    const link = pad.querySelector('.pad-link');
    const img  = pad.querySelector('.pad-logo');
    const url  = partnerUrls[index] || "";

    img.src = partners[index];

    if (url) {
      link.href = url;
      link.style.cursor = 'pointer';
    } else {
      link.removeAttribute('href');
      link.style.cursor = 'default';
    }

    if (fadeIn) {
      requestAnimationFrame(() => img.classList.replace('opacity-0', 'opacity-100'));
    }
  }

  pads.forEach((pad, i) => applyPartner(pad, currentIndices[i]));

  pads.forEach((pad, i) => {
    const cycle = () => {
      const img = pad.querySelector('.pad-logo');
      img.classList.replace('opacity-100', 'opacity-0');
      setTimeout(() => {
        const inUse = currentIndices.filter((_, j) => j !== i);
        let next = (currentIndices[i] + 1) % partners.length;
        let attempts = 0;
        while (inUse.includes(next) && attempts < partners.length) {
          next = (next + 1) % partners.length;
          attempts++;
        }
        currentIndices[i] = next;
        applyPartner(pad, next, true);
      }, 500);
    };
    setTimeout(() => { cycle(); setInterval(cycle, 10000); }, 5000 + i * 1000);
  });
</script>

<script define:vars={{ teamMembers, memberData }}>
  const SVG_W = 847;
  const SVG_H = 378;

  const busImg       = document.getElementById('bus-img');
  const busContainer = document.getElementById('bus-container');
  const busShadow    = document.getElementById('bus-shadow');
  const teamWindows  = document.querySelectorAll('.team-window');

  function positionWindows() {
    const renderedW = busImg.offsetWidth;
    const renderedH = busImg.offsetHeight;
    teamWindows.forEach((win) => {
      const svgX = parseFloat(win.dataset.svgx);
      const svgY = parseFloat(win.dataset.svgy);
      const svgW = parseFloat(win.dataset.svgw);
      const svgH = parseFloat(win.dataset.svgh);
      win.style.left   = `${(svgX / SVG_W) * renderedW}px`;
      win.style.top    = `${(svgY / SVG_H) * renderedH}px`;
      win.style.width  = `${(svgW / SVG_W) * renderedW}px`;
      win.style.height = `${(svgH / SVG_H) * renderedH}px`;
    });
  }

  busImg.addEventListener('load', positionWindows);
  if (busImg.complete) positionWindows();
  window.addEventListener('resize', positionWindows);

  if (teamMembers.length === 0) return;

  function getMemberInfo(src) {
    for (const [key, info] of Object.entries(memberData)) {
      if (src.includes(key)) return info;
    }
    return { name: 'Team Member', role: '' };
  }

  const total = teamWindows.length;
  const currentIndices = Array.from({ length: total }, (_, i) =>
    Math.floor((i * teamMembers.length) / total)
  );

  function applyMember(win, index) {
    const img   = win.querySelector('.team-member-img');
    const label = win.querySelector('.team-member-name');
    const info = getMemberInfo(teamMembers[index]);
    img.src = teamMembers[index];
    label.innerHTML = `<span class="block font-bold">${info.name}</span><span class="block opacity-80">${info.role}</span>`;
    win.classList.replace('opacity-0', 'opacity-100');
  }

  function loadNewMembers() {
    teamWindows.forEach((win, i) => {
      const inUse = currentIndices.filter((_, j) => j !== i);
      let next = (currentIndices[i] + 1) % teamMembers.length;
      let attempts = 0;
      while (inUse.includes(next) && attempts < teamMembers.length) {
        next = (next + 1) % teamMembers.length;
        attempts++;
      }
      currentIndices[i] = next;
      applyMember(win, next);
    });
  }

  function driveOffAndBack() {
    busContainer.classList.remove('bus-enter');
    busShadow.classList.remove('bus-enter');
    busContainer.classList.add('bus-exit');
    busShadow.classList.add('bus-exit');

    setTimeout(() => {
      loadNewMembers();
      positionWindows();

      busContainer.classList.remove('bus-exit');
      busShadow.classList.remove('bus-exit');
      void busContainer.offsetWidth;
      busContainer.classList.add('bus-enter');
      busShadow.classList.add('bus-enter');
    }, 1300);
  }

  teamWindows.forEach((win, i) => applyMember(win, currentIndices[i]));

  setInterval(driveOffAndBack, 10000);
</script>